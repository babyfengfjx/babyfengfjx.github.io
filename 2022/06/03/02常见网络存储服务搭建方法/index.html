<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="常见网络存储服务搭建方法"><meta name="keywords" content="linux,ftp,NFS"><meta name="author" content="babyfengfjx"><meta name="copyright" content="babyfengfjx"><title>常见网络存储服务搭建方法 | babyfengfjx'Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"RPHOC0H5T9","apiKey":"723903e5de5899f6cc4ad96fc50931c1","indexName":"hexo_blog","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '6.3.0'
} </script><meta name="generator" content="Hexo 6.3.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Samba%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA"><span class="toc-number">1.</span> <span class="toc-text">Samba服务搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.1.</span> <span class="toc-text">安装服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-number">1.2.</span> <span class="toc-text">创建共享文件夹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.3.</span> <span class="toc-text">编辑配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.3.1.</span> <span class="toc-text">全局设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B1%E4%BA%AB%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.3.2.</span> <span class="toc-text">共享设置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7"><span class="toc-number">1.4.</span> <span class="toc-text">添加用户</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%8B%E4%BA%88%E6%9D%83%E9%99%90"><span class="toc-number">1.5.</span> <span class="toc-text">赋予权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8%E3%80%81%E5%81%9C%E6%AD%A2%E3%80%81%E9%87%8D%E5%90%AF"><span class="toc-number">1.6.</span> <span class="toc-text">服务启动、停止、重启</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%EF%BC%9Aservice-smbd-start"><span class="toc-number">1.6.1.</span> <span class="toc-text">启动服务：service smbd start</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%81%9C%E6%AD%A2%E6%9C%8D%E5%8A%A1%EF%BC%9Aservice-smbd-stop"><span class="toc-number">1.6.2.</span> <span class="toc-text">停止服务：service smbd stop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%90%AF%E6%9C%8D%E5%8A%A1%EF%BC%9Aservice-smbd-restart"><span class="toc-number">1.6.3.</span> <span class="toc-text">重启服务：service smbd restart</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%9C%8D%E5%8A%A1%E7%8A%B6%E6%80%81%EF%BC%9Aservice-smbd-status"><span class="toc-number">1.6.4.</span> <span class="toc-text">查看服务状态：service smbd status</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="toc-number">1.7.</span> <span class="toc-text">常见问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#FTP%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA"><span class="toc-number">2.</span> <span class="toc-text">FTP服务搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#vsftpd%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8"><span class="toc-number">2.1.</span> <span class="toc-text">vsftpd配置使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">2.1.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%90%AF%E5%81%9C%E9%85%8D%E7%BD%AE"><span class="toc-number">2.1.2.</span> <span class="toc-text">服务的启停配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">启动服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%81%9C%E6%AD%A2%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.1.2.2.</span> <span class="toc-text">停止服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E5%90%AF%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.1.2.3.</span> <span class="toc-text">重启服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%9C%8D%E5%8A%A1%E7%8A%B6%E6%80%81"><span class="toc-number">2.1.2.4.</span> <span class="toc-text">查看服务状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%B1%95%E7%A4%BA"><span class="toc-number">2.1.2.5.</span> <span class="toc-text">配置文件展示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BC%80%E5%90%AF%E7%9A%84%E9%85%8D%E7%BD%AE%E9%A1%B9%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="toc-number">2.1.2.6.</span> <span class="toc-text">实际开启的配置项如下：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">2.1.2.7.</span> <span class="toc-text">遇到的问题</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SFTP%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA"><span class="toc-number">3.</span> <span class="toc-text">SFTP服务搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BE%A4%E7%BB%84%E9%85%8D%E7%BD%AE%E2%80%94%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">3.1.</span> <span class="toc-text">群组配置—服务端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B1%E4%BA%AB%E7%9B%AE%E5%BD%95%E2%80%94%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">3.2.</span> <span class="toc-text">共享目录—服务端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BF%AE%E6%94%B9%E2%80%94%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">3.3.</span> <span class="toc-text">配置文件修改—服务端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E6%8E%88%E6%9D%83%E4%B8%8E%E6%96%B0%E5%BB%BA%E2%80%94%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">3.4.</span> <span class="toc-text">目录授权与新建—服务端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E5%90%AF%E6%9C%8D%E5%8A%A1%E2%80%94%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">3.5.</span> <span class="toc-text">重启服务—服务端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%9C%8D%E5%8A%A1%E5%99%A8%E2%80%94%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">3.6.</span> <span class="toc-text">访问服务器—客户端</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NFS%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA"><span class="toc-number">4.</span> <span class="toc-text">NFS服务搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">4.1.</span> <span class="toc-text">服务端</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85"><span class="toc-number">4.1.1.</span> <span class="toc-text">工具安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%A4%B9-1"><span class="toc-number">4.1.2.</span> <span class="toc-text">创建共享文件夹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">4.1.3.</span> <span class="toc-text">修改配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BF%AE%E6%94%B9%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="toc-number">4.1.4.</span> <span class="toc-text">配置文件修改如下：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1-1"><span class="toc-number">4.1.5.</span> <span class="toc-text">启动服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%9C%8D%E5%8A%A1%E7%8A%B6%E6%80%81-1"><span class="toc-number">4.1.6.</span> <span class="toc-text">查看服务状态</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AE"><span class="toc-number">4.2.</span> <span class="toc-text">客户端配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%89%E8%A3%85"><span class="toc-number">4.2.1.</span> <span class="toc-text">客户端安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%9C%8D%E5%8A%A1%E7%AB%AFnfs%E5%85%B1%E4%BA%AB%E4%BF%A1%E6%81%AF"><span class="toc-number">4.2.2.</span> <span class="toc-text">查看服务端nfs共享信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%88%9B%E5%BB%BA%E6%8C%82%E8%BD%BD%E7%9B%AE%E5%BD%95"><span class="toc-number">4.2.3.</span> <span class="toc-text">客户端创建挂载目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8C%82%E8%BD%BD"><span class="toc-number">4.2.4.</span> <span class="toc-text">客户端挂载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%B9%B6%E4%BC%A0%E8%BE%93%E6%96%87%E4%BB%B6"><span class="toc-number">4.2.5.</span> <span class="toc-text">查看并传输文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E6%9C%BA%E8%87%AA%E5%8A%A8%E6%8C%82%E8%BD%BD"><span class="toc-number">4.2.6.</span> <span class="toc-text">开机自动挂载</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E5%85%A5fstab%E8%BF%9B%E8%A1%8C%E5%BC%80%E6%9C%BA%E8%87%AA%E5%8A%A8%E6%8C%82%E8%BD%BD"><span class="toc-number">4.2.6.1.</span> <span class="toc-text">写入fstab进行开机自动挂载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E9%85%8D%E7%BD%AE%E5%BC%80%E6%9C%BA%E8%87%AA%E8%BF%90%E8%A1%8C%E8%84%9A%E6%9C%AC"><span class="toc-number">4.2.6.2.</span> <span class="toc-text">通过配置开机自运行脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E6%8F%90%E4%BE%9B%E5%8F%AF%E8%83%BD%E5%AF%BC%E8%87%B4%E8%84%9A%E6%9C%AC%E6%97%A0%E6%B3%95%E6%AD%A3%E5%B8%B8%E5%90%AF%E5%8A%A8%E7%9A%84%E5%8E%9F%E5%9B%A0%EF%BC%9A"><span class="toc-number">4.2.6.2.1.</span> <span class="toc-text">这里提供可能导致脚本无法正常启动的原因：</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://github.com/babyfengfjx/babyfengfjx.github.io/blob/main/pictures/avatar/avatar.jpg?raw=true"></div><div class="author-info__name text-center">babyfengfjx</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">16</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">25</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">12</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">babyfengfjx'Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">常见网络存储服务搭建方法</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-06-03</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/linux/">linux</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/linux/%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1/">存储服务</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><hr>
<h1 id="Samba服务搭建"><a href="#Samba服务搭建" class="headerlink" title="Samba服务搭建"></a>Samba服务搭建</h1><blockquote>
<p>Samba是在Linux系统上实现SMB协议的一个免费软件，由服务器及客户端程序构成。SMB（Server Messages Block，信息服务块）是一种在局域网上共享文件和打印机的一种通信协议，它为局域网内的不同计算机之间提供文件及打印机等资源的共享服务。</p>
</blockquote>
<h2 id="安装服务"><a href="#安装服务" class="headerlink" title="安装服务"></a>安装服务</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get install samba-common samba</span><br></pre></td></tr></table></figure>
<h2 id="创建共享文件夹"><a href="#创建共享文件夹" class="headerlink" title="创建共享文件夹"></a>创建共享文件夹</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> /opt/share</span><br></pre></td></tr></table></figure>
<h2 id="编辑配置文件"><a href="#编辑配置文件" class="headerlink" title="编辑配置文件"></a>编辑配置文件</h2><blockquote>
<ul>
<li>关于samba配置文件，smb.conf总共分为两大部分，分别为“全局设置（GIobal Settings）”和“共享定义（Share Definitions）”。全局设置定义于Samba服务器的整体行为，例如，工作组，主机名等方面。共享定义则用于设置的具体的共享目录或者设备中。</li>
<li>配置文件绝对路径在：<code>/etc/samba/smb.conf</code></li>
</ul>
</blockquote>
<h3 id="全局设置"><a href="#全局设置" class="headerlink" title="全局设置"></a>全局设置</h3><ul>
<li>workgroup用于设置在windows中显示的工作组</li>
<li>server string是Samba服务器的说明</li>
<li>workgroup和server string字段后面的内容可以随便写</li>
<li>通常来说，将Samba服务器的编码设置为UTF-8是比较好的，也能解决显示的问题：<code>unix charset = UTF-8</code></li>
<li>但是这样也会存在问题，UTF-8编码的中文文件名在某些系统下面会乱码，Samba提供了dos charset这个字段。下面这条配置命令为哪些不认识的Unicode的Windows系统使用GBK编码:<code>dos charset = cp936</code></li>
<li>security字段设置了用户登录的验证方式，share和user是最常用到的两种。share方式允许任何用户登录到系统，而不用提供用户名和口令,但是由于Samba是默认要使用验证方式的，所以这里就要讲到user方式。这种方式要求用户提供账户信息供服务器验证，但是要使用user验证，Samba的配置文件里面就应该包含这一行:<code>security = user</code></li>
</ul>
<h3 id="共享设置"><a href="#共享设置" class="headerlink" title="共享设置"></a>共享设置</h3><p>这个文件叫做smb.conf（位于&#x2F;etc或者&#x2F;etc&#x2F;samba目录下面），可以用uos系统自带的文本编辑器打开，在末尾输入：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[share] <span class="comment">#&quot;[]&quot; 中的文字表示共享目录名字，可以随意设置</span></span><br><span class="line">    comment = Linux Share　 <span class="comment">#comment字段用于设置这个共享目录的描述</span></span><br><span class="line">    path = /opt/share　　　　 <span class="comment">#share指定了共享目录的路径</span></span><br><span class="line">    public = <span class="built_in">yes</span>　　　　　　 <span class="comment">#表示在windows的“网上邻居”中可见</span></span><br><span class="line">    writeable = no　　　　　 <span class="comment">#writeable表示设置目录是否可写（yes是可写的意思）</span></span><br><span class="line">    browseable = <span class="built_in">yes</span>　　　 <span class="comment">#表示在windows的“网上邻居”中可见</span></span><br><span class="line">    guest ok = no 　　　　　<span class="comment">#告诉Samba服务器这个共享目录允许匿名访问</span></span><br></pre></td></tr></table></figure>
<h2 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo useradd smbuser  <span class="comment"># 新增一个叫smbuser的用户</span></span><br><span class="line">sudo smbpasswd -a smbuser  <span class="comment"># 给这个新增用户创建samb共享密码</span></span><br><span class="line">New SMB password:</span><br><span class="line">Retype new SMB password:</span><br><span class="line">Added user smbuser</span><br></pre></td></tr></table></figure>
<p>后面就可以使用带-U参数的smbpasswd命令修改已经有用户的口令。如果用户希望本地修改服务器上自己的口令，可以使用-r参数。下面的命令用户修改在服务器smbserver上smbuser用户的口令了</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">smbpasswd -r smbserver -U smbuser</span><br></pre></td></tr></table></figure>
<h2 id="赋予权限"><a href="#赋予权限" class="headerlink" title="赋予权限"></a>赋予权限</h2><p>smbuser对共享目录写权限,一下配置需要写成yes</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">writeable = <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>
<p>如果只写writeable &#x3D; yes是远远不够的，如果服务器上的这么目录本身对smbuser不可写的话，就需要添加以下命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo <span class="built_in">chown</span> smbuser:smbuser /opt/share</span><br></pre></td></tr></table></figure>
<h2 id="服务启动、停止、重启"><a href="#服务启动、停止、重启" class="headerlink" title="服务启动、停止、重启"></a>服务启动、停止、重启</h2><h3 id="启动服务：service-smbd-start"><a href="#启动服务：service-smbd-start" class="headerlink" title="启动服务：service smbd start"></a>启动服务：<code>service smbd start</code></h3><h3 id="停止服务：service-smbd-stop"><a href="#停止服务：service-smbd-stop" class="headerlink" title="停止服务：service smbd stop"></a>停止服务：<code>service smbd stop</code></h3><h3 id="重启服务：service-smbd-restart"><a href="#重启服务：service-smbd-restart" class="headerlink" title="重启服务：service smbd restart"></a>重启服务：<code>service smbd restart</code></h3><h3 id="查看服务状态：service-smbd-status"><a href="#查看服务状态：service-smbd-status" class="headerlink" title="查看服务状态：service smbd status"></a>查看服务状态：<code>service smbd status</code></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">deepin@wh-k8snode-70:/etc/samba$ service smbd status</span><br><span class="line">● smbd.service - Samba SMB Daemon</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/smbd.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Mon 2022-06-20 11:50:46 CST; 1h 57min ago</span><br><span class="line">     Docs: man:smbd(8)</span><br><span class="line">           man:samba(7)</span><br><span class="line">           man:smb.conf(5)</span><br><span class="line">  Process: 20165 ExecStartPre=/usr/share/samba/update-apparmor-samba-profile (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 20174 (smbd)</span><br><span class="line">   Status: <span class="string">&quot;smbd: ready to serve connections...&quot;</span></span><br><span class="line">    Tasks: 6 (<span class="built_in">limit</span>: 4915)</span><br><span class="line">   Memory: 26.7M</span><br><span class="line">   CGroup: /system.slice/smbd.service</span><br><span class="line">           ├─ 8209 /usr/sbin/smbd --foreground --no-process-group</span><br><span class="line">           ├─10619 /usr/sbin/smbd --foreground --no-process-group</span><br><span class="line">           ├─20174 /usr/sbin/smbd --foreground --no-process-group</span><br><span class="line">           ├─20176 /usr/sbin/smbd --foreground --no-process-group</span><br><span class="line">           ├─20177 /usr/sbin/smbd --foreground --no-process-group</span><br><span class="line">           └─20178 /usr/sbin/smbd --foreground --no-process-group</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><ol>
<li><p>修改配置文件后，服务无法启动。</p>
<blockquote>
<p>在实际修改配置文件过程中，可能在参数后面有一些看不见的字符，会导致服务无法正常启动，最好检查每个修改的参数后面无一些空格或者其他特殊符号。</p>
</blockquote>
</li>
<li><p>创建了几个samba用户，想通过不同的用户来对不同的文件进行访问，但是出现了报错（内容是不允许一个用户使用一个以上用户名与服务器或者共享资源的多重连接）<br><strong>解决：</strong></p>
<blockquote>
<p>先断开现有的samba连接：cmd命令行下执行net use * &#x2F;del &#x2F;X<br>再重新选择你要使用的目录，使用对应的用户名进行登录就可以了</p>
</blockquote>
</li>
<li><p>配置好samba服务器，但是测试过程中会出现以下报错：</p>
<blockquote>
<p>主要原因是因为服务器的防火墙没有关，可以选择在文件&#x2F;etc&#x2F;security&#x2F;limits.conf下输入*　-   nofile   16384,然后shutdown -r now 重启一下就可以了</p>
</blockquote>
</li>
<li><p>samba服务器已经可以让windows通过网络来访问samba，但是没有办法写入，修改，删除，只能查看,出现这样的问题可能就是我们自己在配置的时候出现问题了，如果我的用户是deepin:</p>
<figure class="highlight plaintext"><figcaption><span>777 FileServer```   　--这种操作就可以让组samba里的用户进行写操作了。</span></figcaption><table><tr><td class="code"><pre><span class="line">```bash</span><br><span class="line">[deepin]</span><br><span class="line">   create mode =0664</span><br><span class="line">   force create mode=0750   #文件新建的权限为750</span><br><span class="line">   directory mode=0750      　#新建文件夹的权限只有组里的用户查看，其他组里的用户都没有权限进入</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="FTP服务搭建"><a href="#FTP服务搭建" class="headerlink" title="FTP服务搭建"></a>FTP服务搭建</h1><h2 id="vsftpd配置使用"><a href="#vsftpd配置使用" class="headerlink" title="vsftpd配置使用"></a>vsftpd配置使用</h2><blockquote>
<p>vsftpd 是Linus上非常安全好用的ftp服务，只需要简单的安装后就可以搭建起ftp服务；<br>该服务主要的配置文件就是vsftpd.conf ,在deepin&#x2F;uos系统中的绝对路径是：&#x2F;etc&#x2F;vsftpd.conf</p>
</blockquote>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>只需要简单的进行安装配置即可，前提是你开启了开发者模式我们才能通过终端安装软件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install vsftpd</span><br></pre></td></tr></table></figure>
<p>如果提示没有找到对应安装包，则可能是没有进行仓库的更新连接，执行如下命令即可</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt update </span><br></pre></td></tr></table></figure>
<h3 id="服务的启停配置"><a href="#服务的启停配置" class="headerlink" title="服务的启停配置"></a>服务的启停配置</h3><h4 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service vsftpd start</span><br></pre></td></tr></table></figure>
<h4 id="停止服务"><a href="#停止服务" class="headerlink" title="停止服务"></a>停止服务</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service vsftpd stop</span><br></pre></td></tr></table></figure>
<h4 id="重启服务"><a href="#重启服务" class="headerlink" title="重启服务"></a>重启服务</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service vsftpd restart</span><br></pre></td></tr></table></figure>
<h4 id="查看服务状态"><a href="#查看服务状态" class="headerlink" title="查看服务状态"></a>查看服务状态</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service vsftpd status</span><br><span class="line"><span class="comment">#执行后结果如下：active则表示正常运行，如果失败了则可以通过提示信息查询对应问题</span></span><br><span class="line">babyfengfjx@babyfengfjx:~$ service vsftpd status </span><br><span class="line">● vsftpd.service - vsftpd FTP server</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/vsftpd.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Sat 2021-10-09 16:22:48 CST; 1s ago</span><br><span class="line">  Process: 18334 ExecStartPre=/bin/mkdir -p /var/run/vsftpd/empty (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 18335 (vsftpd)</span><br><span class="line">    Tasks: 1 (<span class="built_in">limit</span>: 4915)</span><br><span class="line">   Memory: 568.0K</span><br><span class="line">   CGroup: /system.slice/vsftpd.service</span><br><span class="line">           └─18335 /usr/sbin/vsftpd /etc/vsftpd.conf</span><br></pre></td></tr></table></figure>
<h4 id="配置文件展示"><a href="#配置文件展示" class="headerlink" title="配置文件展示"></a>配置文件展示</h4><p>在使用该服务过程中，主要就是这些配置文件该如何配置，很多同学在实际配置过程中很难一次配置成功，这里就给出一个实际可用的配置参数以供参考 </p>
<p>配置文件路径：&#x2F;etc&#x2F;vsftpd.conf</p>
<p>配置过程中尽量是将匿名登录关闭，使用本地用户登录，以确保安全。 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Example config file /etc/vsftpd.conf</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The default compiled in settings are fairly paranoid. This sample file</span></span><br><span class="line"><span class="comment"># loosens things up a bit, to make the ftp daemon more usable.</span></span><br><span class="line"><span class="comment"># Please see vsftpd.conf.5 for all compiled in defaults.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># READ THIS: This example file is NOT an exhaustive list of vsftpd options.</span></span><br><span class="line"><span class="comment"># Please read the vsftpd.conf.5 manual page to get a full idea of vsftpd&#x27;s</span></span><br><span class="line"><span class="comment"># capabilities.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Run standalone?  vsftpd can run either from an inetd or as a standalone</span></span><br><span class="line"><span class="comment"># daemon started from an initscript.</span></span><br><span class="line">listen=YES</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This directive enables listening on IPv6 sockets. By default, listening</span></span><br><span class="line"><span class="comment"># on the IPv6 &quot;any&quot; address (::) will accept connections from both IPv6</span></span><br><span class="line"><span class="comment"># and IPv4 clients. It is not necessary to listen on *both* IPv4 and IPv6</span></span><br><span class="line"><span class="comment"># sockets. If you want that (perhaps because you want to listen on specific</span></span><br><span class="line"><span class="comment"># addresses) then you must run two copies of vsftpd with two configuration</span></span><br><span class="line"><span class="comment"># files.</span></span><br><span class="line">listen_ipv6=NO</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Allow anonymous FTP? (Disabled by default).</span></span><br><span class="line">anonymous_enable=NO</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Uncomment this to allow local users to log in.</span></span><br><span class="line">local_enable=YES</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Uncomment this to enable any form of FTP write command.</span></span><br><span class="line">write_enable=YES</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Default umask for local users is 077. You may wish to change this to 022,</span></span><br><span class="line"><span class="comment"># if your users expect that (022 is used by most other ftpd&#x27;s)</span></span><br><span class="line"><span class="comment">#local_umask=022</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Uncomment this to allow the anonymous FTP user to upload files. This only</span></span><br><span class="line"><span class="comment"># has an effect if the above global write enable is activated. Also, you will</span></span><br><span class="line"><span class="comment"># obviously need to create a directory writable by the FTP user.</span></span><br><span class="line"><span class="comment">#anon_upload_enable=YES</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Uncomment this if you want the anonymous FTP user to be able to create</span></span><br><span class="line"><span class="comment"># new directories.</span></span><br><span class="line"><span class="comment">#anon_mkdir_write_enable=YES</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Activate directory messages - messages given to remote users when they</span></span><br><span class="line"><span class="comment"># go into a certain directory.</span></span><br><span class="line">dirmessage_enable=YES</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If enabled, vsftpd will display directory listings with the time</span></span><br><span class="line"><span class="comment"># in  your  local  time  zone.  The default is to display GMT. The</span></span><br><span class="line"><span class="comment"># times returned by the MDTM FTP command are also affected by this</span></span><br><span class="line"><span class="comment"># option.</span></span><br><span class="line">use_localtime=YES</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Activate logging of uploads/downloads.</span></span><br><span class="line">xferlog_enable=YES</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Make sure PORT transfer connections originate from port 20 (ftp-data).</span></span><br><span class="line">connect_from_port_20=YES</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If you want, you can arrange for uploaded anonymous files to be owned by</span></span><br><span class="line"><span class="comment"># a different user. Note! Using &quot;root&quot; for uploaded files is not</span></span><br><span class="line"><span class="comment"># recommended!</span></span><br><span class="line"><span class="comment">#chown_uploads=YES</span></span><br><span class="line"><span class="comment">#chown_username=whoever</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You may override where the log file goes if you like. The default is shown</span></span><br><span class="line"><span class="comment"># below.</span></span><br><span class="line"><span class="comment">#xferlog_file=/var/log/vsftpd.log</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If you want, you can have your log file in standard ftpd xferlog format.</span></span><br><span class="line"><span class="comment"># Note that the default log file location is /var/log/xferlog in this case.</span></span><br><span class="line"><span class="comment">#xferlog_std_format=YES</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You may change the default value for timing out an idle session.</span></span><br><span class="line"><span class="comment">#idle_session_timeout=600</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You may change the default value for timing out a data connection.</span></span><br><span class="line"><span class="comment">#data_connection_timeout=120</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># It is recommended that you define on your system a unique user which the</span></span><br><span class="line"><span class="comment"># ftp server can use as a totally isolated and unprivileged user.</span></span><br><span class="line"><span class="comment">#nopriv_user=ftpsecure</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Enable this and the server will recognise asynchronous ABOR requests. Not</span></span><br><span class="line"><span class="comment"># recommended for security (the code is non-trivial). Not enabling it,</span></span><br><span class="line"><span class="comment"># however, may confuse older FTP clients.</span></span><br><span class="line"><span class="comment">#async_abor_enable=YES</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># By default the server will pretend to allow ASCII mode but in fact ignore</span></span><br><span class="line"><span class="comment"># the request. Turn on the below options to have the server actually do ASCII</span></span><br><span class="line"><span class="comment"># mangling on files when in ASCII mode.</span></span><br><span class="line"><span class="comment"># Beware that on some FTP servers, ASCII support allows a denial of service</span></span><br><span class="line"><span class="comment"># attack (DoS) via the command &quot;SIZE /big/file&quot; in ASCII mode. vsftpd</span></span><br><span class="line"><span class="comment"># predicted this attack and has always been safe, reporting the size of the</span></span><br><span class="line"><span class="comment"># raw file.</span></span><br><span class="line"><span class="comment"># ASCII mangling is a horrible feature of the protocol.</span></span><br><span class="line"><span class="comment">#ascii_upload_enable=YES</span></span><br><span class="line"><span class="comment">#ascii_download_enable=YES</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You may fully customise the login banner string:</span></span><br><span class="line"><span class="comment">#ftpd_banner=Welcome to blah FTP service.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You may specify a file of disallowed anonymous e-mail addresses. Apparently</span></span><br><span class="line"><span class="comment"># useful for combatting certain DoS attacks.</span></span><br><span class="line"><span class="comment">#deny_email_enable=YES</span></span><br><span class="line"><span class="comment"># (default follows)</span></span><br><span class="line"><span class="comment">#banned_email_file=/etc/vsftpd.banned_emails</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You may restrict local users to their home directories.  See the FAQ for</span></span><br><span class="line"><span class="comment"># the possible risks in this before using chroot_local_user or</span></span><br><span class="line"><span class="comment"># chroot_list_enable below.</span></span><br><span class="line"><span class="comment"># chroot_local_user=YES</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You may specify an explicit list of local users to chroot() to their home</span></span><br><span class="line"><span class="comment"># directory. If chroot_local_user is YES, then this list becomes a list of</span></span><br><span class="line"><span class="comment"># users to NOT chroot().</span></span><br><span class="line"><span class="comment"># (Warning! chroot&#x27;ing can be very dangerous. If using chroot, make sure that</span></span><br><span class="line"><span class="comment"># the user does not have write access to the top level directory within the</span></span><br><span class="line"><span class="comment"># chroot)</span></span><br><span class="line"><span class="comment"># chroot_local_user=YES</span></span><br><span class="line"><span class="comment"># chroot_list_enable=YES</span></span><br><span class="line"><span class="comment"># (default follows)</span></span><br><span class="line"><span class="comment"># chroot_list_file=/etc/vsftpd.chroot_list</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You may activate the &quot;-R&quot; option to the builtin ls. This is disabled by</span></span><br><span class="line"><span class="comment"># default to avoid remote users being able to cause excessive I/O on large</span></span><br><span class="line"><span class="comment"># sites. However, some broken FTP clients such as &quot;ncftp&quot; and &quot;mirror&quot; assume</span></span><br><span class="line"><span class="comment"># the presence of the &quot;-R&quot; option, so there is a strong case for enabling it.</span></span><br><span class="line"><span class="comment">#ls_recurse_enable=YES</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Customization</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Some of vsftpd&#x27;s settings don&#x27;t fit the filesystem layout by</span></span><br><span class="line"><span class="comment"># default.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This option should be the name of a directory which is empty.  Also, the</span></span><br><span class="line"><span class="comment"># directory should not be writable by the ftp user. This directory is used</span></span><br><span class="line"><span class="comment"># as a secure chroot() jail at times vsftpd does not require filesystem</span></span><br><span class="line"><span class="comment"># access.</span></span><br><span class="line">secure_chroot_dir=/var/run/vsftpd/empty</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This string is the name of the PAM service vsftpd will use.</span></span><br><span class="line">pam_service_name=vsftpd</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This option specifies the location of the RSA certificate to use for SSL</span></span><br><span class="line"><span class="comment"># encrypted connections.</span></span><br><span class="line">rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem</span><br><span class="line">rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key</span><br><span class="line">ssl_enable=NO</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Uncomment this to indicate that vsftpd use a utf8 filesystem.</span></span><br><span class="line"><span class="comment">#utf8_filesystem=YES</span></span><br></pre></td></tr></table></figure>

<h4 id="实际开启的配置项如下："><a href="#实际开启的配置项如下：" class="headerlink" title="实际开启的配置项如下："></a>实际开启的配置项如下：</h4><p>按照如下简单的配置就可以通过本地用户进行访问了 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">listen=YES</span><br><span class="line">listen_ipv6=NO</span><br><span class="line">anonymous_enable=NO</span><br><span class="line">local_enable=YES</span><br><span class="line">write_enable=YES</span><br><span class="line">dirmessage_enable=YES</span><br><span class="line">use_localtime=YES</span><br><span class="line">xferlog_enable=YES</span><br><span class="line">connect_from_port_20=YES</span><br><span class="line">secure_chroot_dir=/var/run/vsftpd/empty</span><br><span class="line">pam_service_name=vsftpd</span><br><span class="line">rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem</span><br><span class="line">rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key</span><br><span class="line">ssl_enable=NO</span><br></pre></td></tr></table></figure>
<h4 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h4><ul>
<li>无法配置指定根目录，也就是任何本地账户登录后的目录都是根目录，无法自定义配置指定目录，配置后也不生效； </li>
<li>在添加新用户配置成nologin时，是无法正常使用该类用户进行访问的； </li>
<li>添加的新用户，需要先登录一次后，方可使用该账号访问ftp;</li>
</ul>
<h1 id="SFTP服务搭建"><a href="#SFTP服务搭建" class="headerlink" title="SFTP服务搭建"></a>SFTP服务搭建</h1><h2 id="群组配置—服务端"><a href="#群组配置—服务端" class="headerlink" title="群组配置—服务端"></a>群组配置—服务端</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo groupadd sftp</span><br><span class="line"><span class="built_in">cat</span> /etc/group  <span class="comment"># 确认组新建成功</span></span><br><span class="line">sudo vim /etc/group <span class="comment">#修改 sftp:x:1002:</span></span><br><span class="line">sudo useradd -g sftp -s /bin/false mysftp </span><br><span class="line">sudo passwd mysftp <span class="comment"># 设置新密码为服务器访问密码</span></span><br></pre></td></tr></table></figure>
<h2 id="共享目录—服务端"><a href="#共享目录—服务端" class="headerlink" title="共享目录—服务端"></a>共享目录—服务端</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> -p /data/sftp/mysftp</span><br><span class="line">sudo usermod -d /data/sftp/mysftp mysftp</span><br></pre></td></tr></table></figure>
<h2 id="配置文件修改—服务端"><a href="#配置文件修改—服务端" class="headerlink" title="配置文件修改—服务端"></a>配置文件修改—服务端</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/ssh/sshd_config</span><br><span class="line">Subsystem sftp /usr/libexec/openssh/sftp-server <span class="comment"># 该行原本配置，需要手动注释掉</span></span><br><span class="line">并在文件最后面添加如下几行内容然后保存</span><br><span class="line">Subsystem sftp internal-sftp</span><br><span class="line">Match Group sftp</span><br><span class="line">ChrootDirectory /data/sftp/%u</span><br><span class="line">ForceCommand internal-sftp</span><br><span class="line">AllowTcpForwarding no</span><br><span class="line">X11Forwarding no</span><br></pre></td></tr></table></figure>
<h2 id="目录授权与新建—服务端"><a href="#目录授权与新建—服务端" class="headerlink" title="目录授权与新建—服务端"></a>目录授权与新建—服务端</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo <span class="built_in">chown</span> root:sftp /data/sftp/mysftp</span><br><span class="line">sudo <span class="built_in">chmod</span> 755 /data/sftp/mysftp</span><br><span class="line">sudo <span class="built_in">mkdir</span> /data/sftp/mysftp/upload</span><br><span class="line">sudo <span class="built_in">chown</span> mysftp:sftp /data/sftp/mysftp/upload</span><br><span class="line">sudo <span class="built_in">chmod</span> 755 /data/sftp/mysftp/upload</span><br></pre></td></tr></table></figure>
<h2 id="重启服务—服务端"><a href="#重启服务—服务端" class="headerlink" title="重启服务—服务端"></a>重启服务—服务端</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo systemctl  restart sshd.service   <span class="comment"># 重启服务时如果提示服务不存在，则先添加如下服务</span></span><br><span class="line">systemctl <span class="built_in">enable</span> ssh.service </span><br><span class="line"><span class="comment"># 再执行：</span></span><br><span class="line">sudo systemctl  restart sshd.service </span><br></pre></td></tr></table></figure>
<h2 id="访问服务器—客户端"><a href="#访问服务器—客户端" class="headerlink" title="访问服务器—客户端"></a>访问服务器—客户端</h2><p>进入文件管理器或我的电脑<br>输入—例如sftp：&#x2F;&#x2F;10.20.32.** （根据实际服务端IP输入，并键如账号密码，即可访问）</p>
<h1 id="NFS服务搭建"><a href="#NFS服务搭建" class="headerlink" title="NFS服务搭建"></a>NFS服务搭建</h1><h2 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h2><h3 id="工具安装"><a href="#工具安装" class="headerlink" title="工具安装"></a>工具安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get install nfs-kernel-server <span class="comment"># 安装 NFS服务器端</span></span><br></pre></td></tr></table></figure>

<h3 id="创建共享文件夹-1"><a href="#创建共享文件夹-1" class="headerlink" title="创建共享文件夹"></a>创建共享文件夹</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> /home/deepin-server/nfs       <span class="comment"># 路径可以根据自己需要设置</span></span><br><span class="line">sudo <span class="built_in">chmod</span> -R 777 /home/deepin-server/nfs    <span class="comment"># 设置共享目录权限</span></span><br></pre></td></tr></table></figure>

<h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><p><code>vim /etc/exports</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">配置文件虽然只有一句，但是其中还是有很多讲究； </span><br><span class="line">共享文件可执行权限有： </span><br><span class="line">      ro           只读访问 </span><br><span class="line">      rw           读写访问 </span><br><span class="line">      <span class="built_in">sync</span>          所有数据在请求时写入共享 </span><br><span class="line">      hide          在NFS共享目录中不共享其子目录 </span><br><span class="line">      no_hide         共享NFS目录的子目录 </span><br><span class="line">      all_squash       共享文件的UID和GID映射匿名用户anonymous，适合公用目录。 </span><br><span class="line">      no_all_squash      保留共享文件的UID和GID（默认） </span><br><span class="line">      root_squash       root用户的所有请求映射成如anonymous用户一样的权限（默认） </span><br><span class="line">      no_root_squas      root用户具有根目录的完全管理访问权限 </span><br><span class="line">ip配置一般需要进行限定，最好不要使用* ，不然存在安全问题，可以限定具体ip或者ip段才能挂载。 </span><br></pre></td></tr></table></figure>

<h3 id="配置文件修改如下："><a href="#配置文件修改如下：" class="headerlink" title="配置文件修改如下："></a>配置文件修改如下：</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">deepin-server@deepin-server-PC:~$ cat /etc/exports </span><br><span class="line"># /etc/exports: the access control list for filesystems which may be exported</span><br><span class="line">#               to NFS clients.  See exports(5).</span><br><span class="line">#</span><br><span class="line"># Example for NFSv2 and NFSv3:</span><br><span class="line"># /srv/homes       hostname1(rw,sync,no_subtree_check) hostname2(ro,sync,no_subtree_check)</span><br><span class="line"># Example for NFSv4:</span><br><span class="line"># /srv/nfs4        gss/krb5i(rw,sync,fsid=0,crossmnt,no_subtree_check)</span><br><span class="line"># /srv/nfs4/homes  gss/krb5i(rw,sync,no_subtree_check)</span><br><span class="line">/home/deepin-server/nfs  10.20.*(rw)#此处ip只做了部分限制，圆括号里面就是配置权限的。</span><br></pre></td></tr></table></figure>
<h3 id="启动服务-1"><a href="#启动服务-1" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl start rpcbind nfs-server</span><br></pre></td></tr></table></figure>

<h3 id="查看服务状态-1"><a href="#查看服务状态-1" class="headerlink" title="查看服务状态"></a>查看服务状态</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">deepin-server@deepin-server-PC:~$ sudo systemctl status rpcbind nfs-server</span><br><span class="line">● rpcbind.service - RPC bind portmap service</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/rpcbind.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Wed 2022-01-05 11:53:19 CST; 1h 56min ago</span><br><span class="line">     Docs: man:rpcbind(8)</span><br><span class="line"> Main PID: 19304 (rpcbind)</span><br><span class="line">    Tasks: 1 (limit: 19660)</span><br><span class="line">   Memory: 608.0K</span><br><span class="line">   CGroup: /system.slice/rpcbind.service</span><br><span class="line">           └─19304 /sbin/rpcbind -f -w</span><br><span class="line"></span><br><span class="line">1月 05 11:53:19 deepin-server-PC systemd[1]: Starting RPC bind portmap service...</span><br><span class="line">1月 05 11:53:19 deepin-server-PC systemd[1]: Started RPC bind portmap service.</span><br><span class="line"></span><br><span class="line">● nfs-server.service - NFS server and services</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/nfs-server.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (exited) since Wed 2022-01-05 11:53:21 CST; 1h 56min ago</span><br><span class="line">  Process: 19319 ExecStartPre=/usr/sbin/exportfs -r (code=exited, status=0/SUCCESS)</span><br><span class="line">  Process: 19320 ExecStart=/usr/sbin/rpc.nfsd $RPCNFSDARGS (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 19320 (code=exited, status=0/SUCCESS)</span><br><span class="line"></span><br><span class="line">1月 05 11:53:20 deepin-server-PC systemd[1]: Starting NFS server and services...</span><br><span class="line">1月 05 11:53:20 deepin-server-PC exportfs[19319]: exportfs: /etc/exports [1]: Neither &#x27;subtree_check&#x27; or &#x27;no_subtree_check&#x27; specified for export &quot;10.20.*:/home/deepin-server/Documents/NFS文件目录for-test&quot;.</span><br><span class="line">1月 05 11:53:20 deepin-server-PC exportfs[19319]:   Assuming default behaviour (&#x27;no_subtree_check&#x27;).</span><br><span class="line">1月 05 11:53:20 deepin-server-PC exportfs[19319]:   NOTE: this default has changed since nfs-utils version 1.0.x</span><br><span class="line">1月 05 11:53:21 deepin-server-PC systemd[1]: Started NFS server and services.</span><br><span class="line">deepin-server@deepin-server-PC:~$ </span><br></pre></td></tr></table></figure>
<p>至此服务端算是配置完成了。</p>
<h2 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h2><p>客户端主要就是挂载操作，不过挂载nfs的时候同样需要安装客户端软件</p>
<h3 id="客户端安装"><a href="#客户端安装" class="headerlink" title="客户端安装"></a>客户端安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get install nfs-common</span><br></pre></td></tr></table></figure>

<h3 id="查看服务端nfs共享信息"><a href="#查看服务端nfs共享信息" class="headerlink" title="查看服务端nfs共享信息"></a>查看服务端nfs共享信息</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">showmount -e 10.20.13.152</span><br><span class="line">babyfengfjx@babyfengfjx:~$ showmount -e 10.20.13.152</span><br><span class="line">Export list <span class="keyword">for</span> 10.20.13.152:</span><br><span class="line">/home/deepin-server/Documents/NFS文件目录for-test 10.20.*</span><br><span class="line">babyfengfjx@babyfengfjx:~$ </span><br></pre></td></tr></table></figure>
<h3 id="客户端创建挂载目录"><a href="#客户端创建挂载目录" class="headerlink" title="客户端创建挂载目录"></a>客户端创建挂载目录</h3><p>随便在本地客户端创建一个目录作为NFS挂载目录即可</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> /home/babyfengfjx/Documents/nfsfile/</span><br></pre></td></tr></table></figure>

<h3 id="客户端挂载"><a href="#客户端挂载" class="headerlink" title="客户端挂载"></a>客户端挂载</h3><p>将服务端的NFS共享目录，挂载到本地客户端对应目录即可</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo mount -t nfs 10.20.13.152:/home/deepin-server/Documents/NFS文件目录for-test /home/babyfengfjx/Documents/nfsfile/</span><br></pre></td></tr></table></figure>
<h3 id="查看并传输文件"><a href="#查看并传输文件" class="headerlink" title="查看并传输文件"></a>查看并传输文件</h3><p>上述操作完成后，此时就可以在客户端对应目录使用NFS存储了，上传新建文件均可以随心所欲。</p>
<h3 id="开机自动挂载"><a href="#开机自动挂载" class="headerlink" title="开机自动挂载"></a>开机自动挂载</h3><p>写入fstab方法并不推荐，如果NFS挂载失败可能会影响设备正常启动 </p>
<h4 id="写入fstab进行开机自动挂载"><a href="#写入fstab进行开机自动挂载" class="headerlink" title="写入fstab进行开机自动挂载"></a>写入fstab进行开机自动挂载</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;10.20.13.152:/home/deepin-server/Documents/NFS文件目录for-test /home/babyfengfjx/Documents/nfsfile/ nfs4 defaults 0 0&quot;</span> &gt;&gt; /etc/fstab</span><br><span class="line"> mount -av</span><br></pre></td></tr></table></figure>
<h4 id="通过配置开机自运行脚本"><a href="#通过配置开机自运行脚本" class="headerlink" title="通过配置开机自运行脚本"></a>通过配置开机自运行脚本</h4><p><strong>原理如下：</strong></p>
<blockquote>
<p>新建 &#x2F;etc&#x2F;rc.local 文件<br>这种方法的原理是系统开机后会自动启动 rc-local 服务；<br>rc-local 服务启动后就会自动执行 &#x2F;etc 目录下的 rc.local 脚本；<br>该方法的优点就是不存在第一种方法的三个缺点，脚本执行失败不会出现黑屏弹窗、sleep 不会造成开机黑屏以及执行脚本的用户是 root 用户。 </p>
</blockquote>
<p><strong>主要步骤：</strong></p>
<ol>
<li>新建 &#x2F;etc&#x2F;rc.local 文件</li>
<li>粘贴以下模板<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh -e</span></span><br><span class="line"><span class="comment"># rc.local</span></span><br><span class="line"><span class="comment"># This script is executed at the end of each multiuser runlevel.</span></span><br><span class="line"><span class="comment"># Make sure that the script will &quot;exit 0&quot; on success or any other</span></span><br><span class="line"><span class="comment"># value on error.</span></span><br><span class="line"><span class="comment"># In order to enable or disable this script just change the execution</span></span><br><span class="line"><span class="comment"># bits.</span></span><br><span class="line"><span class="comment"># By default this script does nothing.</span></span><br><span class="line">01.LitterScript/02.bbsmonitor/bbsmonitor.py &gt;bbs.log 2&gt;&amp;1 &amp;</span><br><span class="line"><span class="comment"># 因为该命令本身就是会以root权限执行，所以不用加sudo</span></span><br><span class="line"><span class="built_in">sleep</span> 5;mount -t nfs 10.20.13.152:/home/deepin-server/Documents/NFS文件目录for-test /home/babyfengfjx/Documents/nfsfile/</span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure></li>
<li>在 exit 0 上方插入你需要自启的命令(一行一个)后保存文件</li>
<li>给脚本加上 755 权限<br>sudo chmod +755 &#x2F;etc&#x2F;rc.local</li>
<li>调试脚本(可选)<br>sudo &#x2F;etc&#x2F;rc.local # 使用 sudo 模拟 root 用户开机自启 &#x2F;etc&#x2F;rc.local 文件<br>如果第 5 步模拟启动脚本没有报错，那我们就可以重启电脑看看是否可以成功实现脚本开机自启。重启进入系统后我们可以通过 systemctl status rc-local.service 查看 rc-local 的运行状态，如果结果显示的是 active (exited) 则说明你的脚本已经成功执行，反之如果结果显示 failed,那么你需要检查一下脚本是否哪里有问题。</li>
</ol>
<h5 id="这里提供可能导致脚本无法正常启动的原因："><a href="#这里提供可能导致脚本无法正常启动的原因：" class="headerlink" title="这里提供可能导致脚本无法正常启动的原因："></a>这里提供可能导致脚本无法正常启动的原因：</h5><p>1、执行脚本的用户不一致<br>由于 rc.local 开机自启的时候是以 root 用户执行的，这里很多人会忽略了一个问题，很多情况下你的命令是必须要普通用户执行的。比如 conky 和虚拟机(用户A建立的VBox和VM Ware虚拟机用户B无法访问)等。<br>假设用户 lolimay 在终端用 VBoxHeadless -s aikuai &amp; 后台启动了虚拟机名 aikuai，那么我们在 rc.local 文件应该用下面这种方式写：<br><code>su - lolimay -c &quot;VBoxHeadless -s aikuai &amp;&quot; # 以 lolimay 用户执行该命令</code><br>2、多余的 sudo<br>前面已经提到 rc.local 开机时是以 root 用户启动的，所以写在 rc.local 文件中命令不需要带有 sudo 前缀(实际上就算你带有了 sudo 前缀也不会产生错误)。<br>3、最佳实践<br>个人建议每当往 rc.local 文件中添加了一个需要自启的命令时，可以先用 sudo &#x2F;etc&#x2F;rc.local 命令模拟一下看看是否能够执行成功(如果执行失败也能够直观地看到出错的原因)，这样能够有效减少你重启电脑来调试的次数。</p>
</div></article><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/linux/">linux</a><a class="post-meta__tags" href="/tags/ftp/">ftp</a><a class="post-meta__tags" href="/tags/NFS/">NFS</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2022/07/20/request%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82405/"><i class="fa fa-chevron-left">  </i><span>requests发送post请求返回405的处理方法</span></a></div><div class="next-post pull-right"><a href="/2022/04/03/04IPD/"><span>IPD流程</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="vcomment"></div><script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = 'false' == 'true';
var verify = 'false' == 'true';
var record_ip = 'false' == 'true';
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  recordIP:record_ip,
  appId:'F1Yvbj0NxwrB3DRaljWZOPe9-gzGzoHsz',
  appKey:'vvI8fXV2CIAJXrex6pBlFHBz',
  placeholder:'留下您的评论建议吧~',
  avatar:'wavatar',
  guest_info:guest_info,
  pageSize:'10',
  lang: 'zh-cn'
})</script></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2021 - 2023 By babyfengfjx</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.1"></script><script src="/js/fancybox.js?version=1.9.1"></script><script src="/js/sidebar.js?version=1.9.1"></script><script src="/js/copy.js?version=1.9.1"></script><script src="/js/fireworks.js?version=1.9.1"></script><script src="/js/transition.js?version=1.9.1"></script><script src="/js/scroll.js?version=1.9.1"></script><script src="/js/head.js?version=1.9.1"></script><script src="/js/search/algolia.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>